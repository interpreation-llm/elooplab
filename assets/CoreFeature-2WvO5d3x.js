import{_ as u,c as l,b as t,o as c,n as f,t as d,w as _,v,F as S,r as b,d as y,e as k,f as p,g}from"./index-Do3gliNz.js";const w={props:{perspective:{type:String,default:"A"}},emits:["toggle"],mounted(){this.init3D(),window.addEventListener("keydown",this.handleKeyPress)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress)},methods:{init3D(){const s=this.$refs.canvas,e=s.getContext("2d"),r=[{x:100,y:100},{x:200,y:100},{x:200,y:200},{x:100,y:200},{x:150,y:50},{x:250,y:50},{x:250,y:150},{x:150,y:150}],a=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];this.drawCube=()=>{e.clearRect(0,0,s.width,s.height),e.strokeStyle=this.perspective==="A"?"#3498db":"#e74c3c",e.lineWidth=3,a.forEach(n=>{const[i,o]=n;e.beginPath(),e.moveTo(r[i].x,r[i].y),e.lineTo(r[o].x,r[o].y),e.stroke()})},this.drawCube()},togglePerspective(){this.$emit("toggle")},handleKeyPress(s){s.code==="Space"&&this.togglePerspective()}},watch:{perspective(){this.drawCube()}}},L={ref:"canvas",width:"300",height:"300"};function M(s,e,r,a,n,i){return c(),l("div",{class:"necker-cube",onClick:e[0]||(e[0]=(...o)=>i.togglePerspective&&i.togglePerspective(...o))},[t("canvas",L,null,512)])}const P=u(w,[["render",M],["__scopeId","data-v-56f1c01e"]]),B={props:{state:{type:Object,required:!0}}},F={class:"probability-bars"},I={class:"bar-container"},T={class:"percentage"},D={class:"percentage"};function E(s,e,r,a,n,i){return c(),l("div",F,[t("div",I,[t("div",{class:"bar-a",style:f({height:`${r.state.A*100}%`,background:"linear-gradient(to top, #3498db, #2ecc71)"})},[t("div",T,d((r.state.A*100).toFixed(1))+"%",1)],4),t("div",{class:"bar-b",style:f({height:`${r.state.B*100}%`,background:"linear-gradient(to top, #e74c3c, #f39c12)"})},[t("div",D,d((r.state.B*100).toFixed(1))+"%",1)],4)])])}const U=u(B,[["render",E],["__scopeId","data-v-9d45bd3b"]]),z={props:{precision:{type:Number,required:!0},error:{type:Number,required:!0}},mounted(){this.drawPrecisionGraph()},methods:{drawPrecisionGraph(){this.$refs.precisionCanvas.getContext("2d")}},watch:{precision(){this.drawPrecisionGraph()}}},N={class:"meta-state"},O={class:"precision-graph"},V={ref:"precisionCanvas",width:"200",height:"50"},j={class:"error-display"};function q(s,e,r,a,n,i){return c(),l("div",N,[t("div",O,[t("canvas",V,null,512)]),t("div",j,[t("span",null,"预测误差: "+d(r.error.toFixed(2)),1)])])}const R=u(z,[["render",q]]),J={props:{logs:{type:Array,required:!0}},data(){return{searchText:""}},computed:{filteredLogs(){return this.logs.map(s=>{const e={...s};return s.message.includes("锁定")?e.message="[系统] 我决定坚持当前视角，不再动摇":s.message.includes("解锁")?e.message="[系统] 重新开放感知评估":s.message.includes("切换")?e.message=`[顿悟] 啊！原来是${s.message.split("：")[1]}视角！`:s.message.includes("冻结")&&(e.message=`[控制] ${s.message}`),e}).filter(s=>s.message.toLowerCase().includes(this.searchText.toLowerCase()))}}},G={class:"log-panel"},K={class:"header"},W={class:"log-content"};function H(s,e,r,a,n,i){return c(),l("div",G,[t("div",K,[e[1]||(e[1]=t("h3",null,"感知日志",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.searchText=o),placeholder:"过滤日志...",class:"search-input"},null,512),[[v,n.searchText]])]),t("div",W,[(c(!0),l(S,null,b(i.filteredLogs,(o,h)=>(c(),l("div",{key:h,class:y(["log-entry",{"log-warning":o.message.includes("警告"),"log-error":o.message.includes("错误")}])}," ["+d(o.time)+"] "+d(o.message),3))),128))])])}const Q=u(J,[["render",H],["__scopeId","data-v-a734520c"]]),X={data(){return{animationSpeed:1,simulationSpeed:1e3,themeColor:"blue",priorA:.5}},methods:{saveSettings(){localStorage.setItem("userSettings",JSON.stringify({animationSpeed:this.animationSpeed,simulationSpeed:this.simulationSpeed,themeColor:this.themeColor,priorA:this.priorA})),this.$emit("settings-changed",{priorA:this.priorA})}},mounted(){const s=localStorage.getItem("userSettings");if(s){const e=JSON.parse(s);this.animationSpeed=e.animationSpeed,this.themeColor=e.themeColor}}},Y={class:"settings-panel"},Z={class:"setting-item"},ee={class:"setting-item"},te={class:"setting-item"},se={class:"setting-item"};function ne(s,e,r,a,n,i){return c(),l("div",Y,[e[10]||(e[10]=t("h3",null,"用户设置",-1)),t("div",Z,[e[5]||(e[5]=t("label",null,"动画速度",-1)),_(t("input",{type:"range",min:"0.1",max:"2",step:"0.1","onUpdate:modelValue":e[0]||(e[0]=o=>n.animationSpeed=o)},null,512),[[v,n.animationSpeed]]),t("span",null,d(n.animationSpeed)+"x",1)]),t("div",ee,[e[6]||(e[6]=t("label",null,"模拟速度 (ms)",-1)),_(t("input",{type:"range",min:"100",max:"3000",step:"100","onUpdate:modelValue":e[1]||(e[1]=o=>n.simulationSpeed=o)},null,512),[[v,n.simulationSpeed]]),t("span",null,d(n.simulationSpeed),1)]),t("div",te,[e[8]||(e[8]=t("label",null,"主题颜色",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.themeColor=o)},[...e[7]||(e[7]=[t("option",{value:"blue"},"蓝色",-1),t("option",{value:"green"},"绿色",-1),t("option",{value:"red"},"红色",-1)])],512),[[k,n.themeColor]])]),t("div",se,[e[9]||(e[9]=t("label",null,"先验概率A",-1)),_(t("input",{type:"range",min:"0.1",max:"0.9",step:"0.1","onUpdate:modelValue":e[3]||(e[3]=o=>n.priorA=o)},null,512),[[v,n.priorA]]),t("span",null,d(n.priorA),1)]),t("button",{onClick:e[4]||(e[4]=(...o)=>i.saveSettings&&i.saveSettings(...o))},"保存设置")])}const oe=u(X,[["render",ne],["__scopeId","data-v-05a03a5a"]]),ie={props:{monologues:{type:Array,required:!0,default:()=>[]}}},re={class:"inner-monologue"},ae={class:"monologue-content"},le={class:"timestamp"},ce={class:"content"};function de(s,e,r,a,n,i){return c(),l("div",re,[e[0]||(e[0]=t("h3",null,"AI内心独白",-1)),t("div",ae,[(c(!0),l(S,null,b(r.monologues,(o,h)=>(c(),l("div",{key:h,class:"monologue-entry"},[t("span",le,d(o.timestamp),1),t("span",ce,d(o.content),1)]))),128))])])}const ue=u(ie,[["render",de],["__scopeId","data-v-9176f097"]]);class pe{constructor(){this.monologues=[],this.innerMonologues=[],this.thoughtProcess=[],this.state={A:.5,B:.5},this.precision=.9,this.predictionError=0}logThought(e){const r=new Date().toLocaleTimeString();let a=e,n=e;if(!e){const i=this.state.A>this.state.B?"A":"B",o=Math.max(this.state.A,this.state.B);o>.9?(a=`[稳定期] 我确信我看到的是视角${i}（置信度：${o.toFixed(2)}）。`,n=`[内心独白] 我正专注于视角${i}，感觉非常确定。`):this.predictionError>.2?(a="[临界点] 不确定性过高！重新评估中...",n="[内心独白] 我感到困惑，需要重新思考..."):o<.8?(a=`[累积期] 检测到预测误差轻微上升，我的确定性开始动摇（置信度：${o.toFixed(2)}）。`,n=`[内心独白] 我对视角${i}的确定性在下降...`):(a=`[切换] 啊！现在我清晰地看到了视角${i}！`,n=`[内心独白] 突然，我清晰地看到了视角${i}！`)}return this.monologues.push({timestamp:r,content:a}),this.innerMonologues.push({timestamp:r,content:n}),this.monologues.length>50&&this.monologues.shift(),this.innerMonologues.length>50&&this.innerMonologues.shift(),this.monologues}getMonologues(){return this.innerMonologues}update(){return this.predictionError=Math.random()*.1,this.state.A=Math.random(),this.state.B=1-this.state.A,this.logThought(),this.state}}const ge={name:"CoreFeature",components:{NeckerCube:P,ProbabilityBars:U,MetaState:R,LogPanel:Q,UserSettings:oe,InnerMonologue:ue},data(){return{engine:new pe,state:{A:.5,B:.5},precision:.9,predictionError:0,isFrozen:!1,logs:[],innerMonologues:[],isLocked:!1,simulationSpeed:1e3}},methods:{runInference(){this.isFrozen||(this.state=this.engine.update(),this.precision=this.engine.precision,this.predictionError=this.engine.predictionError,this.logs.unshift({time:new Date().toLocaleTimeString(),message:`状态更新: A=${this.state.A.toFixed(2)}, B=${this.state.B.toFixed(2)}`}),this.innerMonologues=[...this.engine.innerMonologues],this.logs.length>10&&this.logs.pop()),setTimeout(this.runInference,this.simulationSpeed)},toggleFreeze(){this.isFrozen=!this.isFrozen,this.logs.unshift({time:new Date().toLocaleTimeString(),message:`感知已${this.isFrozen?"冻结":"恢复"}`})},toggleLock(){this.isLocked=!this.isLocked},exportData(){const s={state:this.state,logs:this.logs,timestamp:new Date().toISOString()},e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download=`perception-data_${new Date().toLocaleDateString()}.json`,a.click(),URL.revokeObjectURL(r)},applySettings(s){s=s||JSON.parse(localStorage.getItem("userSettings")||"{}"),s.animationSpeed&&(this.$refs.neckerCube.animationSpeed=s.animationSpeed),s.priorA&&(this.engine.state.A=s.priorA,this.engine.state.B=1-s.priorA)},handleToggle(){}},computed:{currentPerspective(){return this.state.A>this.state.B?"A":"B"}},mounted(){this.runInference()}},he={class:"core-feature"},me={class:"left-panel"},_e={class:"center-panel"},ve={class:"right-panel"},fe={class:"controls"};function Se(s,e,r,a,n,i){const o=g("NeckerCube"),h=g("ProbabilityBars"),x=g("MetaState"),$=g("LogPanel"),C=g("InnerMonologue"),A=g("UserSettings");return c(),l("div",he,[t("div",me,[p(o,{perspective:i.currentPerspective,onToggle:i.handleToggle,ref:"neckerCube"},null,8,["perspective","onToggle"]),p(h,{state:n.state},null,8,["state"]),p(x,{precision:n.precision,error:n.predictionError},null,8,["precision","error"])]),t("div",_e,[p($,{logs:n.logs},null,8,["logs"]),p(C,{monologues:n.innerMonologues},null,8,["monologues"])]),t("div",ve,[p(A,{onSettingsChanged:i.applySettings},null,8,["onSettingsChanged"]),t("div",fe,[t("button",{onClick:e[0]||(e[0]=(...m)=>i.toggleFreeze&&i.toggleFreeze(...m))},"冻结感知"),t("button",{onClick:e[1]||(e[1]=(...m)=>i.exportData&&i.exportData(...m))},"导出数据"),t("button",{onClick:e[2]||(e[2]=(...m)=>i.toggleLock&&i.toggleLock(...m)),class:y({active:n.isLocked})},d(n.isLocked?"解锁感知":"锁定当前视角"),3)])])])}const ye=u(ge,[["render",Se],["__scopeId","data-v-17cac069"]]);export{ye as default};
